<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Tour An Giang - Kh√°m Ph√° Mi·ªÅn T√¢y</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.css"/>
    <script src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            color: #fff;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 5px;
        }

        .header p {
            color: #ffd700;
            font-size: 1.1em;
            font-style: italic;
        }

        /* Navigation Menu */
        #menu {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        #menu button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            position: relative;
            overflow: hidden;
        }

        #menu button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        #menu button:hover::before {
            width: 300px;
            height: 300px;
        }

        #menu button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(40, 167, 69, 0.5);
        }

        #menu button.active {
            background: linear-gradient(135deg, #ffc107, #ff9800);
            box-shadow: 0 4px 20px rgba(255, 193, 7, 0.5);
        }

        /* Viewer Container */
        .viewer-container {
            position: relative;
            width: 100%;
            height: 75vh;
            margin: 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        #viewer {
            width: 100%;
            height: 100%;
        }

        /* Scene Counter */
        .scene-counter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        /* Info Panel */
        #info {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(40, 40, 40, 0.95));
            color: white;
            padding: 30px;
            text-align: center;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        }

        #title {
            font-size: 2.2em;
            margin-bottom: 15px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-weight: 700;
        }

        #desc {
            font-size: 1.2em;
            margin-bottom: 25px;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .book-button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            border: none;
            color: white;
            border-radius: 30px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 6px 25px rgba(255, 107, 107, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .book-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 35px rgba(255, 107, 107, 0.6);
            background: linear-gradient(135deg, #ee5a6f, #ff6b6b);
        }

        /* Control Icons */
        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Loading Animation */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            z-index: 5;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            #menu button {
                padding: 10px 18px;
                font-size: 13px;
            }

            .viewer-container {
                height: 60vh;
            }

            #title {
                font-size: 1.6em;
            }

            #desc {
                font-size: 1em;
            }

            .book-button {
                padding: 12px 30px;
                font-size: 16px;
            }
        }

        /* Fade Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #info {
            animation: fadeIn 0.6s ease;
        }

        /* Custom Hotspot Styles */
        .custom-hotspot {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.95), rgba(32, 201, 151, 0.95)) !important;
            color: white !important;
            padding: 12px 20px !important;
            border-radius: 25px !important;
            font-weight: 600 !important;
            font-size: 15px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4) !important;
            backdrop-filter: blur(10px) !important;
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
            cursor: pointer !important;
        }

        .custom-hotspot:hover {
            background: linear-gradient(135deg, rgba(32, 201, 151, 0.95), rgba(40, 167, 69, 0.95)) !important;
            box-shadow: 0 6px 30px rgba(40, 167, 69, 0.6) !important;
        }

        .view-hotspot {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 152, 0, 0.95)) !important;
            color: white !important;
            padding: 10px 18px !important;
            border-radius: 20px !important;
            font-weight: 700 !important;
            font-size: 14px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4) !important;
            backdrop-filter: blur(10px) !important;
            border: 2px solid rgba(255, 255, 255, 0.4) !important;
            cursor: pointer !important;
        }

        .view-hotspot:hover {
            box-shadow: 0 6px 30px rgba(255, 193, 7, 0.8) !important;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* View Navigation */
        .view-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 15;
            display: flex;
            gap: 10px;
        }

        .view-nav.left {
            left: 20px;
        }

        .view-nav.right {
            right: 20px;
        }

        .view-nav-btn {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            font-size: 28px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .view-nav-btn:hover {
            background: rgba(255, 193, 7, 0.9);
            transform: scale(1.15);
            box-shadow: 0 6px 30px rgba(255, 193, 7, 0.6);
        }

        .view-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .view-nav-btn:disabled:hover {
            transform: none;
            background: rgba(0, 0, 0, 0.8);
        }

        /* View Counter */
        .view-counter {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 13px;
            z-index: 10;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>

<div class="header">
    <h1>üåÑ Virtual Tour An Giang üåÑ</h1>
    <p>Kh√°m ph√° v·∫ª ƒë·∫πp thi√™n nhi√™n v√† vƒÉn h√≥a mi·ªÅn T√¢y</p>
</div>

<div id="menu">
    <button onclick="loadScene('angiang')" class="active" data-scene="angiang">üèûÔ∏è An Giang</button>
    <button onclick="loadScene('chaudoc1')" data-scene="chaudoc1">üèØ Ch√¢u ƒê·ªëc</button>
    <button onclick="loadScene('nuicam1')" data-scene="nuicam1">‚õ∞Ô∏è N√∫i C·∫•m</button>
    <button onclick="loadScene('nuisam1')" data-scene="nuisam1">üôè N√∫i Sam</button>
    <button onclick="loadScene('tapa1')" data-scene="tapa1">üíô H·ªì T√† P·∫°</button>
    <button onclick="loadScene('rung1')" data-scene="rung1">üå≥ R·ª´ng Tr√†m</button>
    <button onclick="loadScene('chuatapa1')" data-scene="chuatapa1">üõï Ch√πa T√† P·∫°</button>
    <button onclick="loadScene('tayan1')" data-scene="tayan1">üèõÔ∏è T√¢y An</button>
    <button onclick="loadScene('lang1')" data-scene="lang1">üëë LƒÉng Tho·∫°i Ng·ªçc H·∫ßu</button>
</div>

<div class="viewer-container">
    <div id="viewer"></div>
    <div class="scene-counter" id="sceneCounter">C·∫£nh 1/9</div>
    <div class="view-counter" id="viewCounter" style="display:none;">G√≥c 1/3</div>

    <!-- View Navigation Arrows -->
    <div class="view-nav left" id="viewNavLeft" style="display:none;">
        <button class="view-nav-btn" onclick="previousView()" title="G√≥c xem tr∆∞·ªõc">
            ‚óÄ
        </button>
    </div>
    <div class="view-nav right" id="viewNavRight" style="display:none;">
        <button class="view-nav-btn" onclick="nextView()" title="G√≥c xem ti·∫øp">
            ‚ñ∂
        </button>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        ƒêang t·∫£i...
    </div>
    <div class="controls">
        <button class="control-btn" id="audioBtn" onclick="toggleAudio()" title="Ph√°t/T·∫Øt √¢m thanh">
            üîä
        </button>
        <button class="control-btn" onclick="toggleAutoRotate()" title="T·ª± ƒë·ªông xoay">
            üîÑ
        </button>
        <button class="control-btn" onclick="toggleFullscreen()" title="To√†n m√†n h√¨nh">
            ‚õ∂
        </button>
    </div>
</div>

<div id="info">
    <h2 id="title">An Giang</h2>
    <p id="desc">To√†n c·∫£nh An Giang - V√πng ƒë·∫•t gi√†u b·∫£n s·∫Øc vƒÉn h√≥a mi·ªÅn T√¢y</p>
    <button class="book-button" onclick="bookTour()">
        üé´ ƒê·∫∑t tour ngay
    </button>
</div>

<script>
    const descriptions = {
        "angiang": "To√†n c·∫£nh An Giang - V√πng ƒë·∫•t gi√†u b·∫£n s·∫Øc vƒÉn h√≥a mi·ªÅn T√¢y",
        "chaudoc1": "Mi·∫øu B√† Ch√¢u ƒê·ªëc - N∆°i linh thi√™ng b·∫≠c nh·∫•t mi·ªÅn T√¢y",
        "nuicam1": "N√∫i C·∫•m - N√≥c nh√† mi·ªÅn T√¢y v·ªõi ƒë·ªô cao 710m",
        "nuisam1": "N√∫i Sam - Trung t√¢m t√¢m linh n·ªïi ti·∫øng v√πng ƒë·ªìng b·∫±ng",
        "tapa1": "H·ªì T√† P·∫° - Tuy·ªát t√¨nh c·ªëc ƒë·∫πp nh∆∞ tranh v·∫Ω",
        "rung1": "R·ª´ng Tr√†m Tr√† S∆∞ - R·ª´ng ng·∫≠p m·∫∑n xanh m√°t quanh nƒÉm",
        "chuatapa1": "Ch√πa T√† P·∫° - Ng√¥i ch√πa linh thi√™ng tr√™n ƒë·ªìi cao",
        "tayan1": "T√¢y An C·ªï T·ª± - Ki·∫øn tr√∫c Khmer ƒë·ªôc ƒë√°o v√† tinh x·∫£o",
        "lang1": "LƒÉng Tho·∫°i Ng·ªçc H·∫ßu - Di t√≠ch l·ªãch s·ª≠ vƒÉn h√≥a qu·ªëc gia"
    };

    const tourIds = {
        "angiang": 1,
        "chaudoc1": 1,
        "nuicam1": 31,
        "nuisam1": 32,
        "tapa1": 4,
        "rung1": 3,
        "chuatapa1": 33,
        "tayan1": 7,
        "lang1": 34
    };

    const sceneNames = [
        "angiang", "chaudoc1", "nuicam1", "nuisam1",
        "tapa1", "rung1", "chuatapa1", "tayan1", "lang1"
    ];

    // Map of location views
    const locationViews = {
        "chaudoc": ["chaudoc1", "chaudoc2"],
        "nuicam": ["nuicam1", "nuicam2", "nuicam3"],
        "nuisam": ["nuisam1", "nuisam2", "nuisam3"],
        "tapa": ["tapa1", "tapa2", "tapa3"],
        "rung": ["rung1", "rung2", "rung3"],
        "chuatapa": ["chuatapa1", "chuatapa2", "chuatapa3"],
        "tayan": ["tayan1", "tayan2", "tayan3"],
        "lang": ["lang1", "lang2"]
    };

    // Audio files for each location
    const locationAudios = {
        "angiang": "/audio/angiang.mp3",
        "chaudoc1": "/audio/chaudoc.mp3",
        "nuicam1": "/audio/nuicam.mp3",
        "nuisam1": "/audio/nuisam.mp3",
        "tapa1": "/audio/hotapa.mp3",
        "rung1": "/audio/rung.mp3",
        "chuatapa1": "/audio/chuatapa.mp3",
        "tayan1": "/audio/tayan.mp3",
        "lang1": "/audio/thoaingochau.mp3"
    };

    let autoRotateEnabled = true;
    let currentLocation = "angiang";
    let currentViewIndex = 0;
    let currentAudio = null;

    const viewer = pannellum.viewer('viewer', {
        "default": {
            "firstScene": "angiang",
            "autoLoad": true,
            "autoRotate": -2, // T·ª± ƒë·ªông xoay nh·∫π sang tr√°i (-2 ƒë·ªô/gi√¢y)
            "autoRotateInactivityDelay": 2000, // Sau 2 gi√¢y kh√¥ng t∆∞∆°ng t√°c s·∫Ω t·ª± xoay
            "autoRotateStopDelay": 3000,
            "compass": true,
            "northOffset": 0,
            "showZoomCtrl": true,
            "mouseZoom": true,
            "draggable": true,
            "friction": 0.15,
            "hfov": 100,
            "pitch": 0,
            "yaw": 0
        },
        "scenes": {
            "angiang": {
                "panorama": "/image/test.JPG",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": -5,
                        "yaw": 45,
                        "type": "scene",
                        "sceneId": "chaudoc1",
                        "text": "üèØ Ch√¢u ƒê·ªëc",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": 0,
                        "yaw": 90,
                        "type": "scene",
                        "sceneId": "nuicam1",
                        "text": "‚õ∞Ô∏è N√∫i C·∫•m",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -5,
                        "yaw": 135,
                        "type": "scene",
                        "sceneId": "nuisam1",
                        "text": "üôè N√∫i Sam",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": 0,
                        "yaw": 180,
                        "type": "scene",
                        "sceneId": "tapa1",
                        "text": "üíô H·ªì T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -5,
                        "yaw": -135,
                        "type": "scene",
                        "sceneId": "rung1",
                        "text": "üå≥ R·ª´ng Tr√†m",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": 0,
                        "yaw": -90,
                        "type": "scene",
                        "sceneId": "chuatapa1",
                        "text": "üõï Ch√πa T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -5,
                        "yaw": -45,
                        "type": "scene",
                        "sceneId": "tayan1",
                        "text": "üèõÔ∏è T√¢y An",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": 0,
                        "yaw": 0,
                        "type": "scene",
                        "sceneId": "lang1",
                        "text": "üëë LƒÉng Tho·∫°i Ng·ªçc H·∫ßu",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },

            "chaudoc1": {
                "panorama": "/image/thoaingochau2.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "chaudoc2",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": -45,
                        "type": "scene",
                        "sceneId": "nuicam1",
                        "text": "‚õ∞Ô∏è N√∫i C·∫•m",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 180,
                        "type": "scene",
                        "sceneId": "angiang",
                        "text": "üèûÔ∏è T·ªïng quan An Giang",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "chaudoc2": {
                "panorama": "/image/test3.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "chaudoc1",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 45,
                        "type": "scene",
                        "sceneId": "nuicam1",
                        "text": "‚õ∞Ô∏è N√∫i C·∫•m",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },

            "nuicam1": {
                "panorama": "/image/dlnuicam1.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "nuicam2",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": -90,
                        "type": "scene",
                        "sceneId": "chaudoc1",
                        "text": "üèØ Ch√¢u ƒê·ªëc",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 45,
                        "type": "scene",
                        "sceneId": "nuisam1",
                        "text": "üôè N√∫i Sam",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "nuicam2": {
                "panorama": "/image/dlnuicam2.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "nuicam1",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "nuicam3",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 0,
                        "type": "scene",
                        "sceneId": "nuisam1",
                        "text": "üôè N√∫i Sam",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "nuicam3": {
                "panorama": "/image/dlnuicam3.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "nuicam2",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 90,
                        "type": "scene",
                        "sceneId": "nuisam1",
                        "text": "üôè N√∫i Sam",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },

            "nuisam1": {
                "panorama": "/image/dlnuisam1.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "nuisam2",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": -90,
                        "type": "scene",
                        "sceneId": "nuicam1",
                        "text": "‚õ∞Ô∏è N√∫i C·∫•m",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 45,
                        "type": "scene",
                        "sceneId": "tapa1",
                        "text": "üíô H·ªì T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "nuisam2": {
                "panorama": "/image/dlnuisam2.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "nuisam1",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "nuisam3",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 0,
                        "type": "scene",
                        "sceneId": "tapa1",
                        "text": "üíô H·ªì T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "nuisam3": {
                "panorama": "/image/dlnuisam3.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "nuisam2",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 90,
                        "type": "scene",
                        "sceneId": "tapa1",
                        "text": "üíô H·ªì T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },

            "tapa1": {
                "panorama": "/image/tapa3.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "tapa2",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": -90,
                        "type": "scene",
                        "sceneId": "nuisam1",
                        "text": "üôè N√∫i Sam",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 45,
                        "type": "scene",
                        "sceneId": "rung1",
                        "text": "üå≥ R·ª´ng Tr√†m",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "tapa2": {
                "panorama": "/image/tapa2.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "tapa1",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "tapa3",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 0,
                        "type": "scene",
                        "sceneId": "rung1",
                        "text": "üå≥ R·ª´ng Tr√†m",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "tapa3": {
                "panorama": "/image/tapa1.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "tapa2",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 90,
                        "type": "scene",
                        "sceneId": "rung1",
                        "text": "üå≥ R·ª´ng Tr√†m",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },

            "rung1": {
                "panorama": "/image/rungtram1.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "rung2",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": -90,
                        "type": "scene",
                        "sceneId": "tapa1",
                        "text": "üíô H·ªì T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 45,
                        "type": "scene",
                        "sceneId": "chuatapa1",
                        "text": "üõï Ch√πa T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "rung2": {
                "panorama": "/image/rungtram2.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "rung1",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "rung3",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 0,
                        "type": "scene",
                        "sceneId": "chuatapa1",
                        "text": "üõï Ch√πa T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "rung3": {
                "panorama": "/image/rungtram3.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "rung2",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 90,
                        "type": "scene",
                        "sceneId": "chuatapa1",
                        "text": "üõï Ch√πa T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },

            "chuatapa1": {
                "panorama": "/image/tapa1.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "chuatapa2",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": -90,
                        "type": "scene",
                        "sceneId": "rung1",
                        "text": "üå≥ R·ª´ng Tr√†m",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 45,
                        "type": "scene",
                        "sceneId": "tayan1",
                        "text": "üèõÔ∏è T√¢y An",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "chuatapa2": {
                "panorama": "/image/tapa2.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "chuatapa1",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "chuatapa3",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 0,
                        "type": "scene",
                        "sceneId": "tayan1",
                        "text": "üèõÔ∏è T√¢y An",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "chuatapa3": {
                "panorama": "/image/tapa3.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "chuatapa2",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 90,
                        "type": "scene",
                        "sceneId": "tayan1",
                        "text": "üèõÔ∏è T√¢y An",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },

            "tayan1": {
                "panorama": "/image/tayan1.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "tayan2",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": -90,
                        "type": "scene",
                        "sceneId": "chuatapa1",
                        "text": "üõï Ch√πa T√† P·∫°",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 45,
                        "type": "scene",
                        "sceneId": "lang1",
                        "text": "üëë LƒÉng Tho·∫°i Ng·ªçc H·∫ßu",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "tayan2": {
                "panorama": "/image/tayan2.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "tayan1",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "tayan3",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 0,
                        "type": "scene",
                        "sceneId": "lang1",
                        "text": "üëë LƒÉng Tho·∫°i Ng·ªçc H·∫ßu",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "tayan3": {
                "panorama": "/image/tayan3.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "tayan2",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 90,
                        "type": "scene",
                        "sceneId": "lang1",
                        "text": "üëë LƒÉng Tho·∫°i Ng·ªçc H·∫ßu",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },

            "lang1": {
                "panorama": "/image/thoaingochau2.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": 100,
                        "type": "scene",
                        "sceneId": "lang2",
                        "text": "‚û°Ô∏è G√≥c xem kh√°c",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": -90,
                        "type": "scene",
                        "sceneId": "tayan1",
                        "text": "üèõÔ∏è T√¢y An",
                        "cssClass": "custom-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 180,
                        "type": "scene",
                        "sceneId": "angiang",
                        "text": "üèûÔ∏è T·ªïng quan An Giang",
                        "cssClass": "custom-hotspot"
                    }
                ]
            },
            "lang2": {
                "panorama": "/image/thoaingochau1.jpg",
                "autoRotate": -2,
                "hotSpots": [
                    {
                        "pitch": 5,
                        "yaw": -100,
                        "type": "scene",
                        "sceneId": "lang1",
                        "text": "‚¨ÖÔ∏è G√≥c xem tr∆∞·ªõc",
                        "cssClass": "view-hotspot"
                    },
                    {
                        "pitch": -8,
                        "yaw": 45,
                        "type": "scene",
                        "sceneId": "angiang",
                        "text": "üèûÔ∏è T·ªïng quan An Giang",
                        "cssClass": "custom-hotspot"
                    }
                ]
            }
        }
    });

    function loadScene(id) {
        // Show loading
        document.getElementById('loading').classList.add('active');

        // Update active button - find base location
        let baseLocation = getBaseLocation(id);
        document.querySelectorAll('#menu button').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.scene === baseLocation) {
                btn.classList.add('active');
            }
        });

        // Load scene
        viewer.loadScene(id);

        // Update current location and view
        currentLocation = baseLocation;
        updateViewNavigation(id);

        // Play audio for this location
        playLocationAudio(baseLocation);

        // Update info
        document.getElementById("title").innerText = getSceneTitle(baseLocation);
        document.getElementById("desc").innerText = descriptions[baseLocation] || "";
        window.currentScene = baseLocation;

        // Update scene counter
        updateSceneCounter(baseLocation);

        // Hide loading after scene loads
        setTimeout(() => {
            document.getElementById('loading').classList.remove('active');
        }, 500);
    }

    function playLocationAudio(location) {
        // Stop current audio if playing
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
        }

        // Get audio file for this location
        const audioFile = locationAudios[location];
        if (audioFile) {
            currentAudio = new Audio(audioFile);
            currentAudio.loop = true;
            currentAudio.volume = 0.5;

            // Play audio
            currentAudio.play().catch(err => {
                console.log('Audio autoplay prevented:', err);
            });

            // Update button icon
            document.getElementById('audioBtn').innerHTML = 'üîä';
        }
    }

    function toggleAudio() {
        const btn = document.getElementById('audioBtn');
        if (currentAudio) {
            if (currentAudio.paused) {
                currentAudio.play();
                btn.innerHTML = 'üîä';
            } else {
                currentAudio.pause();
                btn.innerHTML = 'üîá';
            }
        }
    }

    function getBaseLocation(sceneId) {
        // Extract base location from scene ID
        for (let location in locationViews) {
            if (locationViews[location].includes(sceneId)) {
                return locationViews[location][0];
            }
        }
        return sceneId;
    }

    function getLocationFromScene(sceneId) {
        // Get the location key (e.g., "chaudoc" from "chaudoc1")
        for (let location in locationViews) {
            if (locationViews[location].includes(sceneId)) {
                return location;
            }
        }
        return null;
    }

    function updateViewNavigation(sceneId) {
        const location = getLocationFromScene(sceneId);

        if (location && locationViews[location]) {
            const views = locationViews[location];
            currentViewIndex = views.indexOf(sceneId);

            // Show view counter and navigation
            const viewCounter = document.getElementById('viewCounter');
            viewCounter.textContent = `G√≥c ${currentViewIndex + 1}/${views.length}`;
            viewCounter.style.display = 'block';

            // Show/hide navigation buttons
            const navLeft = document.getElementById('viewNavLeft');
            const navRight = document.getElementById('viewNavRight');

            if (views.length > 1) {
                navLeft.style.display = 'flex';
                navRight.style.display = 'flex';

                // Enable/disable buttons
                navLeft.querySelector('button').disabled = currentViewIndex === 0;
                navRight.querySelector('button').disabled = currentViewIndex === views.length - 1;
            } else {
                navLeft.style.display = 'none';
                navRight.style.display = 'none';
            }
        } else {
            // Single view location
            document.getElementById('viewCounter').style.display = 'none';
            document.getElementById('viewNavLeft').style.display = 'none';
            document.getElementById('viewNavRight').style.display = 'none';
        }
    }

    function previousView() {
        const location = getLocationFromScene(viewer.getScene());
        if (location && locationViews[location] && currentViewIndex > 0) {
            const views = locationViews[location];
            loadScene(views[currentViewIndex - 1]);
        }
    }

    function nextView() {
        const location = getLocationFromScene(viewer.getScene());
        if (location && locationViews[location]) {
            const views = locationViews[location];
            if (currentViewIndex < views.length - 1) {
                loadScene(views[currentViewIndex + 1]);
            }
        }
    }

    function getSceneTitle(id) {
        const titles = {
            "angiang": "An Giang",
            "chaudoc1": "Ch√¢u ƒê·ªëc",
            "nuicam1": "N√∫i C·∫•m",
            "nuisam1": "N√∫i Sam",
            "tapa1": "H·ªì T√† P·∫°",
            "rung1": "R·ª´ng Tr√†m Tr√† S∆∞",
            "chuatapa1": "Ch√πa T√† P·∫°",
            "tayan1": "T√¢y An C·ªï T·ª±",
            "lang1": "LƒÉng Tho·∫°i Ng·ªçc H·∫ßu"
        };
        return titles[id] || id;
    }

    function updateSceneCounter(id) {
        const index = sceneNames.indexOf(id);
        if (index !== -1) {
            document.getElementById('sceneCounter').innerText = `C·∫£nh ${index + 1}/${sceneNames.length}`;
        }
    }

    function toggleAutoRotate() {
        autoRotateEnabled = !autoRotateEnabled;
        if (autoRotateEnabled) {
            viewer.setAutoRotate(-2);
        } else {
            viewer.setAutoRotate(false);
        }
    }

    function toggleFullscreen() {
        const elem = document.querySelector('.viewer-container');
        if (!document.fullscreenElement) {
            elem.requestFullscreen().catch(err => {
                console.log(`Error: ${err.message}`);
            });
        } else {
            document.exitFullscreen();
        }
    }

    function bookTour() {
        let id = tourIds[window.currentScene] || 1;
        window.location.href = "/tour/" + id;
    }

    // Initialize
    window.currentScene = "angiang";
    updateSceneCounter("angiang");
    updateViewNavigation("angiang");

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft') {
            previousView();
        } else if (e.key === 'ArrowRight') {
            nextView();
        }
    });

    // Listen for scene changes to update navigation and menu
    viewer.on('scenechange', function(sceneId) {
        // Update view navigation
        updateViewNavigation(sceneId);

        // Update menu active state
        let baseLocation = getBaseLocation(sceneId);
        document.querySelectorAll('#menu button').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.scene === baseLocation) {
                btn.classList.add('active');
            }
        });

        // Update info panel
        document.getElementById("title").innerText = getSceneTitle(baseLocation);
        document.getElementById("desc").innerText = descriptions[baseLocation] || "";
        window.currentScene = baseLocation;

        // Update scene counter
        updateSceneCounter(baseLocation);

        // Update current location
        if (currentLocation !== baseLocation) {
            currentLocation = baseLocation;
            // Play new audio when changing to different location
            playLocationAudio(baseLocation);
        }
    });
</script>

</body>
</html>